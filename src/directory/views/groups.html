{% extends "layout.html" %}

{% block title %}Groups - Remote Directory{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin: 0;">Groups</h2>
    <a href="/groups/new" class="btn btn-primary">+ Add Group</a>
</div>

<div class="filter-controls">
    <input type="text" id="searchInput" placeholder="Search groups..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
</div>

<p style="margin-top: 15px;">Total groups: <strong id="totalCount">{{ groups|length }}</strong> | Showing: <strong id="visibleCount">{{ groups|length }}</strong></p>

{% if groups %}
<table id="groupTable">
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Members</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for group in groups %}
        <tr data-name="{{ group.name|lower }}" data-description="{{ group.description|lower if group.description else '' }}">
            <td>{{ group.name }}</td>
            <td>{{ group.description or 'N/A' }}</td>
            <td>{{ group.members|length if group.members else 0 }}</td>
            <td>
                <a href="/groups/{{ group.id }}/edit" class="user-link">Edit</a> |
                <a href="#" class="user-link" onclick="return confirmDelete(event, '{{ group.id }}', '{{ group.name }}', 'group')">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="noResults" class="empty-state" style="display: none;">
    <p>No groups match your search criteria.</p>
</div>
{% else %}
<div class="empty-state">
    <p>No groups found. Create your first group to get started.</p>
</div>
{% endif %}

<script>
const searchInput = document.getElementById('searchInput');
const groupTable = document.getElementById('groupTable');
const noResults = document.getElementById('noResults');
const visibleCount = document.getElementById('visibleCount');

function filterGroups() {
    const searchTerm = searchInput.value.toLowerCase();
    const tbody = groupTable.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    let visibleRows = rows.filter(row => {
        const name = row.dataset.name;
        const description = row.dataset.description;
        return name.includes(searchTerm) || description.includes(searchTerm);
    });
    
    rows.forEach(row => row.style.display = 'none');
    visibleRows.forEach(row => row.style.display = '');
    
    visibleCount.textContent = visibleRows.length;
    
    if (visibleRows.length === 0 && groupTable) {
        groupTable.style.display = 'none';
        noResults.style.display = 'block';
    } else if (groupTable) {
        groupTable.style.display = 'table';
        noResults.style.display = 'none';
    }
}

if (searchInput) {
    searchInput.addEventListener('input', filterGroups);
}

function confirmDelete(event, id, name, type) {
    event.preventDefault();
    if (confirm(`Are you sure you want to delete ${type} "${name}"?`)) {
        fetch(`/${type}s/${id}`, {
            method: 'DELETE',
            headers: {'Content-Type': 'application/json'}
        })
        .then(response => {
            if (response.ok) {
                window.location.reload();
            } else {
                alert(`Failed to delete ${type}. Please try again.`);
            }
        })
        .catch(error => {
            alert(`Error deleting ${type}: ` + error.message);
        });
    }
    return false;
}
</script>
{% endblock %}
